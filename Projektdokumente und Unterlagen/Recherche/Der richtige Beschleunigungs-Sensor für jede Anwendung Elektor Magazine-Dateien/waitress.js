function throttle(e,i,t){var n,r,a,o=null,s=0;t||(t={});var d=function(){s=t.leading===!1?0:Date.now(),o=null,a=e.apply(n,r),o||(n=r=null)};return function(){var l=Date.now();s||t.leading!==!1||(s=l);var u=i-(l-s);return n=this,r=arguments,u<=0||u>i?(o&&(clearTimeout(o),o=null),s=l,a=e.apply(n,r),o||(n=r=null)):o||t.trailing===!1||(o=setTimeout(d,u)),a}}function initWaitress(){"undefined"!=typeof google&&google.loader&&null!=google.loader.ClientLocation&&(latitude=google.loader.ClientLocation.latitude,longitude=google.loader.ClientLocation.longitude,country=google.loader.ClientLocation.address.country_code);var e=jQuery(".advertisement"),t=e.length;for(i=0;i<t;i++)jQuery(e[i]).attr("identifier","advertisement"+i);e.length>0&&cook(e,!1)}function hasBlocker(){return"undefined"==typeof canRunAds}function cook(e,i){items=new Array,e.each(function(e,i){items.push({dish:jQuery(i).attr("ad"),banner:jQuery(i).attr("banner"),identifier:jQuery(i).attr("identifier")})}),jQuery.ajax({type:"GET",url:"https://www.elektormagazine.de/waitress/serve?__callback=waitress",dataType:"jsonp",data:{dishes:items,mobile:isMobile(),lat:latitude,lng:longitude,country:country,hasBlocker:hasBlocker()},success:function(e){if(null!==e.data&&""!==e.data){var t=new Array;dataLength=e.data.length;for(var n=0;n<dataLength;n++)void 0!=e.data[n].data&&e.data[n].data.isPreview&&t.push(e.data[n].data.preview),serve(e.data[n],i);if(jQuery(".ad ~ .advertisement:empty").prev().hide(),t.length>0){for(var r='<div style="position:fixed;bottom:0;left:0;right:0;width:100%;background:#364150;font-family:Verdana;color: #fff;padding-bottom:20px;" id="BannerPreviewContainer"><a href="javascript: jQuery.ajax({ type: \'GET\', url: \'https://www.elektormagazine.de/portal/banner/preview/destroy\', dataType: \'jsonp\', success: function(response){ jQuery(\'#BannerPreviewContainer\').remove();}});" style="float: right;color: #fff;margin: 10px;font-size: 11px;">Leave preview mode</a><h2 style="margin-left:20px;">Banner preview</h2><div style="margin-left:20px;font-size:13px;">The following banners are shown in preview mode:<ul style="margin-left: 40px;margin-top:6px;">',n=0;n<t.length;n++)r+='<li style="line-height:22px;"><b>'+t[n].banner+"</b> in zone <b>"+t[n].zone+"</b></li>";r+="</ul></div></div>",jQuery("body").append(r)}setTimeout(function(){initImpressionTracking(e.data)},1e3),window.onscroll=function(){impress()},impress()}}})}function serve(e,i){if(null!==e&&void 0!==e.data&&null!==e.data&&"-1"!==e.data){var t=e.data,n=jQuery('.advertisement[identifier="'+e.identifier+'"]'),r="";t.showTillClose&&(r='<div class="close-banner" onclick="closeAd('+t.id+",'"+e.identifier+'\');" style="cursor:pointer;position: absolute;right: -14px;top: -24px;margin-top: 10px;margin-left: -22px;width: 75px;text-align: right;font-family: Arial;z-index: 10;">X</div>'),i?(n.append("<div bpzId='"+e.data.id+"' class='_waitress' style='display:none;"+(""!=r?"position: relative;":"")+"'>"+r+t.dish+"</div>"),n.children().first().slideUp("slow",function(){n.children().first().remove(),n.children().first().slideDown("slow")})):n.html('<div bpzId="'+e.data.id+'" style="'+(""!=r?"position: relative;":"")+'" class="_waitress '+(t.isInternalBanner?"internalBanner":"externalBanner")+'">'+r+t.dish+"</div>"),e.ad=n[0],e.viewed=!1,e.showing=null}}function closeAd(e,i){jQuery('.advertisement[identifier="'+i+'"]').remove();try{positionMenu()}catch(t){}jQuery.ajax({type:"GET",url:"https://www.elektormagazine.de/waitress/close/"+e})}function initImpressionTracking(e){e=e.filter(function(e){return"undefined"!=typeof e.ad}),checkAdsOnScreen(e,!1),w.on("scroll resize",throttle(function(){checkAdsOnScreen(e,!0)},100))}function checkAdsOnScreen(e,i){var t=w.height(),n=w.width();e.forEach(function(e){var r=e.ad.getBoundingClientRect();!e.viewed&&isVisible(t,n,r)?(null===e.showing&&i&&(e.showing=new Date,e.timer=setTimeout(function(){checkAdOnScreen(e)},impressionTimeout)),(new Date-e.showing>=impressionTimeout||i===!1)&&(e.viewed=!0,viewAd(e))):(clearTimeout(e.timer),e.showing=null,e.timer=null)})}function checkAdOnScreen(e){var i=w.height(),t=w.width(),n=e.ad.getBoundingClientRect();!e.viewed&&isVisible(i,t,n)&&(clearTimeout(e.timer),e.viewed=!0,viewAd(e))}function viewAd(e){jQuery.ajax({type:"GET",url:"https://www.elektormagazine.de/waitress/impression/"+e.data.id,dataType:"jsonp"})}function isVisible(e,i,t){return t.left>-(t.width/2)&&t.top>-(t.height/2)&&t.bottom<e+t.height/2&&t.right<i+t.width/2}function isMobile(){if(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile/i.test(navigator.userAgent)){var e=navigator.userAgent.toLowerCase();return!(e.indexOf("android")>-1&&e.indexOf("mobile")==-1)}return!1}function _bannerDisplayer(){$(".__zone").hide(),$(".advertisement").css("border","3px red dotted").css("padding","10px 0").each(function(){$(this).append('<span class="__zone">Zone:'+$(this).attr("ad")+"</span>")})}function impress(){$("._waitress").each(function(){var e=window.pageYOffset+window.innerHeight,i=$(this).parent().offset().top;!ads.includes($(this).attr("bpzId"))&&i<e&&(ads.push($(this).attr("bpzId")),jQuery.ajax({type:"PUT",url:"https://www.elektormagazine.de/waitress/observation/"+$(this).attr("bpzId"),dataType:"jsonp"}))})}var latitude=1,longitude=1,country="",w=$(window),impressionTimeout=1e3,ads=[];document.addEventListener("DOMContentLoaded",function(){initWaitress()});